#!/bin/sh
# shellcheck disable=SC2015

#    This file is part of Glorious-Dotfiles.
#
#    Glorious-Dotfiles is free software: you can redistribute it and/or modify it under
#    the terms of the GNU General Public License as published by the
#    Free Software Foundation, either version 3 of the License, or (at your
#    option) any later version.
#
#    Glorious-Dotfiles is distributed in the hope that it will be useful, but
#    WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
#    General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program. If not, see https://www.gnu.org/licenses/.

# Set environment variables to default when they are not set
[ -z "$DOTS_DIR" ] && DOTS_DIR="$HOME/git-src/glorious-dotfiles"
PWD=$DOTS_DIR

# Formatting
# Source: http://colors.sh/
NO_FORMAT="\033[0m"
F_BOLD="\033[1m"

# Colors
# Source: http://colors.sh/
C_LIME="\033[38;5;10m"
C_YELLOW="\033[38;5;11m"

# Command: $ dotsmgr deploy
# Deploy my dotfiles
deploy() {
	printf "${F_BOLD}Checking for updates...${NO_FORMAT}\n"
	git pull
	printf "${F_BOLD}Starting to deploy...${NO_FORMAT}\n"
	printf "Enter the location of the dotfiles list file (defaults to the included stowpkg.list): "
	read stow_list
	[ -z "$stow_list" ] && stow_list="stowpkg.list"

	for STOW_PKG in $(cut -d '#' -f1 $stow_list | sed "/^[[:space:]]*$/d"); do
		printf "${F_BOLD}Deploying '$STOW_PKG'...${NO_FORMAT}"
		stow -S $STOW_PKG -t $HOME
		printf "   ${C_LIME}Done${NO_FORMAT}\n"
	done

	printf "${F_BOLD}Creating a symlink for this script...${NO_FORMAT}"
	ln -s $HOME/.local/bin/dotsmgr && printf "   ${C_LIME}Done!${NO_FORMAT}\nNow you can use this script without being in this directory.\n"
}

# Command: $ dotsmgr push
#push() {
#}

# Command: $ dotsmgr pull
# Pull the latest release of my dotfiles
pull() {
	printf "${F_BOLD}Pulling the latest release...${NO_FORMAT}\n"
	git pull && (printf "${F_BOLD}${C_LIME}Done!${NO_FORMAT}\n" && exit 0) || (printf "Oops! Something wrong happened!\n" && exit 1)
}

# Command: $ dotsmgr help
help() {
	cat << EOF
Usage: [ENVIRONMENT VARIABLES]... dotsmgr [COMMAND] 
Manage dotfiles.

Commands:
	deploy:		Deploys the dotfiles
	pull:		Pulls the latest release of dotfiles
	help: 		Shows usage, commands and environment variables
	about:		Shows information about this script 

Environment variables:
	DOTS_DIR (string):		The directory of the dotfiles repository.
		Default: $HOME/git-src/glorious-dotfiles
EOF
}

# Command: $ dotsmgr about
# About this script
about() {
	cat << EOF
About dotsmgr:
	Author: Neo64YT (https://github.com/neo64yt)
	Git repository: https://github.com/neo64yt/glorious-dotfiles
	Description: A script for managing dotfiles, included in glorious-dotfiles. Mainly using stow to have a neat and clean dotfiles management
EOF
}

# Read functions as commands. Function "help" executed when there is no command / the command used is not supported
[ -n "$1" ] && $1 || (help && exit 1)



# vim: ft=sh
